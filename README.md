# renovate-config

Shared Renovate presets.

## Useful links

- [All configuration options](https://docs.renovatebot.com/configuration-options/)
- [`packageRules` configuration](https://docs.renovatebot.com/configuration-options/#packagerules) for applying custom options to individual packages or groups
- [Built-in presets](https://docs.renovatebot.com/presets-default/) (see also other pages in the same section)
- [Preset definitions](https://github.com/renovatebot/renovate/tree/main/lib/config/presets/internal)

## Presets in this repo

<!--
Most content in this section is generated by scripts/updateReadme.js.

The preset's primary description should be defined and edited in its .json file.

In this section, ONLY edit between "extra content" marker comments!
-->

<!-- start presets -->

### `libraryRecommended`

In your `extends` config: `"github>ecraig12345/renovate-config:libraryRecommended"`

Recommended config for a JS library repo or monorepo, including pinning `devDependencies`.

<!-- start extra content (EDITABLE between these comments) -->

- Extensions:
  - This repo's [default config](#default)
  - Require dependency dashboard approval for major upgrades
- Set the [`rangeStrategy`](https://docs.renovatebot.com/configuration-options/#rangestrategy) for different update types:
  - Pin `devDependencies` (see below)
  - Widen ranges when updating `peerDependencies`
  - For other updates (including `dependencies`), replace the range with a newer one if the new version falls outside it, and update nothing otherwise
- `commitMessageTopic`: Where appropriate, use "devDependencies" in commit messages (instead of the default "dependencies") to be clearer about what is being modified

"Dependency pinning" refers to using a specific version of a dependency (`1.2.3`) rather than a range (`^1.2.3`, `~1.2.3`, etc). Pinning has its pros and cons for different situations, some of which are discussed in [this article from Renovate](https://docs.renovatebot.com/dependency-pinning/). This preset's strategy of pinning _only_ `devDependencies` is less aggressive than the "auto" strategy used in Renovate's `config:base` to reduce the risk of creating unnecessary duplicates in library or tool consumer repos.

<!-- end extra content -->

```json
{
  "extends": [
    "github>ecraig12345/renovate-config",
    "github>ecraig12345/renovate-config:dependencyDashboardMajor"
  ],
  "rangeStrategy": "replace",
  "pin": {
    "group": {
      "commitMessageTopic": "devDependencies"
    }
  },
  "packageRules": [
    {
      "matchDepTypes": ["devDependencies"],
      "commitMessageTopic": "devDependency {{{depName}}}",
      "rangeStrategy": "pin"
    },
    {
      "matchDepTypes": ["peerDependencies"],
      "rangeStrategy": "widen"
    }
  ]
}
```

### `default`

In your `extends` config: `"github>ecraig12345/renovate-config"`

Recommended config which is intended to be appropriate for most projects.

<!-- start extra content (EDITABLE between these comments) -->

This config should be kept relatively unopinionated. It's somewhat similar to Renovate's [`config:base`](https://docs.renovatebot.com/presets-config/#configbase) but does _not_ enable any dependency pinning by default and adds a few extra settings.

- Extensions:
  - `:ignoreModulesAndTests`: Ignore node_modules and anything under common test/fixture directory names
  - `:rebaseStalePrs`: During the Renovate pipeline run, rebase any existing Renovate PRs if the base branch has been updated
  - [`:semanticPrefixFixDepsChoreOthers`](https://docs.renovatebot.com/presets-default/#semanticprefixfixdepschoreothers): If the repo uses semantic commits, Renovate will use `fix` for dependencies and `chore` for others
  - [`group:monorepos`](https://docs.renovatebot.com/presets-group/#groupmonorepos): Group known monorepo packages together
  - [`group:recommended`](https://docs.renovatebot.com/presets-group/#grouprecommended): Other known groupings (mostly not relevant for node)
  - [`worksarounds:all`](https://docs.renovatebot.com/presets-workarounds/#workaroundsall): Workarounds for known problems with packages
- `dependencyDashboard`: Create a dashboard issue showing update status and allowing updates to be manually triggered (GitHub only)
- PR limits: Prevent Renovate from creating an overwhelming number of PRs all at once. It's _highly encouraged_ to adjust these in your repo to fit your team's needs!
- `printConfig`: Log the final resolved config to make debugging easier
- `vulnerabilityAlerts`: Enable PRs to address security vulnerabilities. Note that this **only** works for GitHub and currently is **only** able to update direct dependencies (except in repos using `npm` 6 or older).

<!-- end extra content -->

```json
{
  "extends": [
    ":ignoreModulesAndTests",
    ":rebaseStalePrs",
    ":semanticPrefixFixDepsChoreOthers",
    "group:monorepos",
    "group:recommended",
    "workarounds:all",
    "github>ecraig12345/renovate-config:newConfigWarningIssue"
  ],
  "dependencyDashboard": true,
  "prConcurrentLimit": 10,
  "prHourlyLimit": 2,
  "printConfig": true,
  "vulnerabilityAlerts": {
    "enabled": true
  }
}
```

### `beachballLibraryRecommended`

In your `extends` config: `"github>ecraig12345/renovate-config:beachballLibraryRecommended"`

Dependency management strategy for library repos, including Beachball change file generation.

<!-- start extra content (EDITABLE between these comments) -->

This extends the rules from [`libraryRecommended`](#beachballLibraryRecommended) to also generate appropriate change files after upgrades:

- Change type `none` for updating or pinning `devDependencies`
- Change type `patch` for all other changes

These change types will be correct the majority of the time, but if a different change type is appropriate, you can always edit the change file in the PR before it merges.

Note that in the GitHub app, commands in [`postUpgradeTasks`](https://docs.renovatebot.com/configuration-options/#postupgradetasks) are limited to a specific set of strings for security reasons. As of writing, only the specific commands used in this config are allowed (though `--no-fetch` can optionally be removed).

<!-- end extra content -->

```json
{
  "extends": ["github>ecraig12345/renovate-config:libraryRecommended"],
  "gitAuthor": "Renovate Bot <renovate@whitesourcesoftware.com>",
  "postUpgradeTasks": {
    "commands": [
      "git add --all",
      "npx beachball change --no-fetch --no-commit --type patch --message '{{{commitMessage}}}'",
      "git reset"
    ],
    "fileFilters": ["**/*"],
    "executionMode": "branch"
  },
  "pin": {
    "group": {
      "postUpgradeTasks": {
        "commands": [
          "git add --all",
          "npx beachball change --no-fetch --no-commit --type none --message '{{{commitMessage}}}'",
          "git reset"
        ],
        "fileFilters": ["**/*"],
        "executionMode": "branch"
      }
    }
  },
  "packageRules": [
    {
      "matchDepTypes": ["devDependencies"],
      "postUpgradeTasks": {
        "commands": [
          "git add --all",
          "npx beachball change --no-fetch --no-commit --type none --message '{{{commitMessage}}}'",
          "git reset"
        ],
        "fileFilters": ["**/*"],
        "executionMode": "branch"
      }
    }
  ]
}
```

### `dependencyDashboardMajor`

In your `extends` config: `"github>ecraig12345/renovate-config:dependencyDashboardMajor"`

Require dependency dashboard approval for major upgrades.

<!-- start extra content (EDITABLE between these comments) -->

Major upgrades of certain dependencies may be disruptive or require extra validation, so to avoid the PRs sitting for a long time, it may be desirable to manually approve upgrades.

The downside of setting this policy for all major upgrades is that it reduces the visibility of available upgrades, if nobody is checking the dashboard regularly.

Some alternative strategies which would need to be configured per repo (see [Renovate docs](https://docs.renovatebot.com/configuration-options/#dependencydashboardapproval) for examples):

- Create a `packageRules` group which requires dependency dashboard approval for only major upgrades of specific packages that are known to be high risk/effort.
- Set schedules for individual `packageRules` groups to avoid the upgrades being forgotten.

<!-- end extra content -->

```json
{
  "dependencyDashboard": true,
  "major": {
    "dependencyDashboardApproval": true
  }
}
```

### `groupEslint`

In your `extends` config: `"github>ecraig12345/renovate-config:groupEslint"`

Group all eslint-related updates (except when initially pinning).

<!-- start extra content (EDITABLE between these comments) -->

<!-- end extra content -->

```json
{
  "packageRules": [
    {
      "groupName": "eslint packages",
      "matchPackagePatterns": ["eslint"],
      "matchUpdateTypes": ["major", "minor", "patch", "rollback", "bump"]
    }
  ]
}
```

### `groupFluent`

In your `extends` config: `"github>ecraig12345/renovate-config:groupFluent"`

Group Fluent UI package updates (except when initially pinning).

<!-- start extra content (EDITABLE between these comments) -->

<!-- end extra content -->

```json
{
  "packageRules": [
    {
      "groupName": "Fluent UI packages",
      "matchPackagePrefixes": ["@fluentui/"],
      "matchUpdateTypes": ["major", "minor", "patch", "rollback", "bump"]
    }
  ]
}
```

### `groupJest`

In your `extends` config: `"github>ecraig12345/renovate-config:groupJest"`

Group jest, ts-jest, and jest types (except when initially pinning).

<!-- start extra content (EDITABLE between these comments) -->

<!-- end extra content -->

```json
{
  "packageRules": [
    {
      "groupName": "jest packages",
      "matchPackagePrefixes": ["@jest/", "@types/jest", "jest"],
      "matchPackageNames": ["ts-jest"],
      "matchUpdateTypes": ["major", "minor", "patch", "rollback", "bump"]
    }
  ]
}
```

### `groupRollup`

In your `extends` config: `"github>ecraig12345/renovate-config:groupRollup"`

Group all rollup-related updates (except when initially pinning).

<!-- start extra content (EDITABLE between these comments) -->

<!-- end extra content -->

```json
{
  "packageRules": [
    {
      "groupName": "rollup packages",
      "matchPackagePrefixes": ["@rollup"],
      "matchPackagePatterns": ["^rollup"],
      "matchUpdateTypes": ["major", "minor", "patch", "rollback", "bump"]
    }
  ]
}
```

### `keepFresh`

In your `extends` config: `"github>ecraig12345/renovate-config:keepFresh"`

Keep locally-used dependency versions deduplicated and updated.

<!-- start extra content (EDITABLE between these comments) -->

- [`lockFileMaintenance`](https://docs.renovatebot.com/configuration-options/#lockfilemaintenance): Completely re-create lock files every Monday morning. This will update direct and indirect dependency versions used _only within the repo_ to the latest versions that satisfy semver.
- [`postUpdateOptions`](https://docs.renovatebot.com/configuration-options/#postupdateoptions):
  - `yarnDedupeHighest`: If using yarn, run `yarn-deduplicate --strategy highest` after updates.
  - `npmDedupe`: If using npm, run `npm dedupe` after updates. WARNING: This may slow down Renovate runs significantly.

It's **highly recommended** to manually run the deduplication command before enabling this preset. In a large repo that hasn't been regularly deduplicated (or had its lock file refreshed), it's likely that initial deduplication will cause build breaks due to implicit reliance on subtle interactions between particular old versions.

<!-- end extra content -->

```json
{
  "lockFileMaintenance": {
    "enabled": true,
    "extends": ["schedule:earlyMondays"]
  },
  "postUpdateOptions": ["yarnDedupeHighest", "npmDedupe"]
}
```

### `newConfigWarningIssue`

In your `extends` config: `"github>ecraig12345/renovate-config:newConfigWarningIssue"`

Always create a new issue if there's a config problem (for visibility).

<!-- start extra content (EDITABLE between these comments) -->

<!-- end extra content -->

```json
{
  "configWarningReuseIssue": false
}
```

<!-- end presets -->
